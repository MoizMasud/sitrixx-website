---
import MainLayout from '../../layouts/main.astro';
import AdminLayout from '../../components/AdminLayout';
import DashboardOverview from '../../components/DashboardOverview';
import { baseUrl } from '../../lib/base-url';
---

<MainLayout 
  title="Admin Dashboard - Sitrixx"
  description="Sitrixx admin dashboard overview"
>
  <AdminLayout client:load activePage="overview">
    <DashboardOverview client:load />
  </AdminLayout>

  <!-- Authentication Guard Script -->
  <script define:vars={{ baseUrl }}>
    // Quick auth guard - prevents casual access
    document.addEventListener('DOMContentLoaded', function () {
      const token = localStorage.getItem('sitrixx_token');

      if (!token) {
        // No token â†’ redirect to login immediately
        window.location.href = baseUrl + '/admin/login';
      }
      
      // The AdminLayout component will do the full Supabase verification
      // This script just provides immediate protection before React loads
    });
  </script>
</MainLayout>
